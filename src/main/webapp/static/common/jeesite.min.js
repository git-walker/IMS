/*!
 * Copyright &copy; 2012-2014 <a href="http://www.dhc.com.cn">DHC</a> All rights reserved.
 * 
 * 通用公共方法
 * @author DHC
 * @version 2014-4-29
 */
$(document).ready(function(){try{$("a").bind("focus",function(){if(this.blur){this.blur()}});$("select").select2()}catch(a){}});function include(c,m,e){if(document.getElementById(c)==null){var a=typeof e=="string"?[e]:e;for(var f=0;f<a.length;f++){var b=a[f].replace(/^\s|\s$/g,"");var h=b.split(".");var d=h[h.length-1].toLowerCase();var k=d=="css";var l=k?"link":"script";var g=k?" type='text/css' rel='stylesheet' ":" type='text/javascript' ";var j=(k?"href":"src")+"='"+m+b+"'";document.write("<"+l+(f==0?" id="+c:"")+g+j+"></"+l+">")}}}function getQueryString(b,a){var c=new RegExp("(^|&)"+b+"=([^&]*)(&|$)","i");if(a==""){a=window.location.search}else{a=a.substring(a.indexOf("?"))}r=a.substr(1).match(c);if(r!=null){return unescape(r[2])}return null}function getDictLabel(d,c,a){for(var b=0;b<d.length;b++){var e=d[b];if(e.value==c){return e.label}}return a}function windowOpen(d,c,e,a){var g=parseInt((window.screen.height-a)/2,10),f=parseInt((window.screen.width-e)/2,10),b="location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes,width="+e+",height="+a+",top="+g+",left="+f;window.open(d,c,b)}function resetTip(){top.$.jBox.tip.mess=null}function closeTip(){top.$.jBox.closeTip()}function showTip(d,b,c,a){resetTip();setTimeout(function(){top.$.jBox.tip(d,(b==undefined||b==""?"info":b),{opacity:0,timeout:c==undefined?2000:c})},a==undefined?500:a)}function loading(a){if(a==undefined||a==""){a="正在提交，请稍等..."}resetTip();top.$.jBox.tip(a,"loading",{opacity:0})}function alertx(b,a){top.$.jBox.info(b,"提示",{closed:function(){if(typeof a=="function"){a()}}});top.$(".jbox-body .jbox-icon").css("top","55px")}function confirmx(c,b,a){top.$.jBox.confirm(c,"系统提示",function(d,e,g){if(d=="ok"){if(typeof b=="function"){b()}else{resetTip();location=b}}},{buttonsFocus:1,closed:function(){if(typeof a=="function"){a()}}});top.$(".jbox-body .jbox-icon").css("top","55px");
return false}function promptx(d,c,b,a){top.$.jBox("<div class='form-search' style='padding:20px;text-align:center;'>"+c+"：<input type='text' id='txt' name='txt'/></div>",{title:d,submit:function(e,g,i){if(i.txt==""){top.$.jBox.tip("请输入"+c+"。","error");return false}if(typeof b=="function"){b()}else{resetTip();location=b+encodeURIComponent(i.txt)}},closed:function(){if(typeof a=="function"){a()}}});return false}function addTabPage(e,a,d,c,b){top.$.fn.jerichoTab.addTab({tabFirer:c,title:e,closeable:d==undefined,data:{dataType:"iframe",dataLink:a}}).loadData(b!=undefined)}function cookie(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+m.path:"";var g=m.domain?"; domain="+m.domain:"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}}function pad(b,c){var a=b.toString().length;while(a<c){b="0"+b;a++}return b}function strToDate(a){return new Date(a.replace(/-/g,"/"))}function addDate(a,b){a=a.valueOf();a=a+b*24*60*60*1000;return new Date(a)};

/*******************************************************************************
 * 文件名称：msg_show.js
 * 文件说明：信息提示插件
 * 创建者：maliang
 * 创建时间：2015-11-3
 ******************************************************************************/
(function ($) {
    $.msg_show = {
        Init: function (options) {
            var t = this;
            t.options = $.extend({}, $.msg_show.defaults, options);
            t.options.msg_config = {
                title: '信息',
                text: '',
                class_name:'',
                time: 500
            };
            t.options.msg_config.text = t.options.msg;
            t.options.msg_config.time = t.options.time?t.options.time:2000;
            switch (t.options.type) {
                case 'success':
                    t.options.msg_config.class_name = 'gritter-success gritter-center gritter-light';
                    t._success(t.options.msg_config);
                    break;
                case 'error':
                    t.options.msg_config.class_name = 'gritter-error gritter-center gritter-light';
                    t._error(t.options.msg_config);
                    break;
                default:
                    t.options.msg_config.class_name = 'gritter-error gritter-center gritter-light';
                    t._error(t.options.msg_config);
                    break;
            }
        },
        _success: function (config) {
            $.gritter.add(config);
        },
        _error: function (config) {
            $.gritter.add(config);
        }
    };
    $.msg_show.defaults = {
        'msg': '服务器忙！',
        'type': 'error'
    };
})(jQuery);
/*******************************************************************************
 * 文件名称：msg_confirm.js
 * 文件说明：信息确认插件
 * 创建者：maliang
 * 创建时间：2015-11-3
 ******************************************************************************/
(function ($) {
    $.msg_confirm = {
        Init: function (options) {
            var t = this;
            t.options = $.extend({}, $.msg_confirm.defaults, options);
            bootbox.confirm({
                message: t.options.msg,
                buttons: {
                    confirm: {
                        label: "确定",
                        className: "btn-primary btn-sm",
                    },
                    cancel: {
                        label: "取消",
                        className: "btn-sm",
                    }
                },
                callback: function(res) {
                    if(res == true){
                        t.options.confirm_fn();
                    }else{
                        t.options.cancel_fn();
                    }
                }
             });
        }
    };
    $.msg_confirm.defaults = {
        'msg': '这是信息提示！',
        'confirm_fn':function(){},
        'cancel_fn':function(){}
    };
})(jQuery);
/*******************************************************************************
 * 文件名称：changeGridTable.js
 * 文件说明：更改表格
 * 创建者：maliang
 * 创建时间：2015-11-4
 ******************************************************************************/
(function ($) {
    $.changeGridTable = {
        changeStyle: function (table) {
            var t = this;
            setTimeout(function(){
                t.styleCheckbox(table);
                t.updateActionIcons(table);
                t.updatePagerIcons(table);
                t.enableTooltips(table);
            }, 0);
        },
        changeSize:function(tableId,callback){
            var changeGridWidth = function(gridWidth){
                $.each(tableId,function(i,n){
                    $(n).jqGrid('setGridWidth',gridWidth);
                });
            };

            //resize to fit page size
            var parent_column = $(tableId[0]).closest('[class*="col-"]');
            $(window).off('resize.jqGrid').on('resize.jqGrid', function () {
                if(callback != undefined){
                	callback();
                }
                changeGridWidth(parent_column.width());
            });
            
            //resize on sidebar collapse/expand
            $(document).on('settings.ace.jqGrid' , function(ev, event_name, collapsed) {
                if( event_name === 'sidebar_collapsed' || event_name === 'main_container_fixed' ) {
                    //setTimeout is for webkit only to give time for DOM changes and then redraw!!!
                    setTimeout(function() {
                        changeGridWidth(parent_column.width());
                    }, 0);
                }
            });
            
            //如果你的表格在其他元素（举例：tab pane）里，你需要使用父元素的宽度:
    		/**
    		$(window).on('resize.jqGrid', function () {
    			var parent_width = $(grid_selector).closest('.tab-pane').width();
    			$(grid_selector).jqGrid( 'setGridWidth', parent_width );
    		})
    		//and also set width when tab pane becomes visible
    		$('#myTab a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    		  if($(e.target).attr('href') == '#mygrid') {
    			var parent_width = $(grid_selector).closest('.tab-pane').width();
    			$(grid_selector).jqGrid( 'setGridWidth', parent_width );
    		  }
    		})
    		*/
            
            $(window).triggerHandler('resize.jqGrid');//trigger window resize to make the grid get the correct size
        },
        
        //it causes some flicker when reloading or navigating grid
        //it may be possible to have some custom formatter to do this as the grid is being created to prevent this
        //or go back to default browser checkbox styles for the grid
        styleCheckbox:function(table){
             $(table).find('input:checkbox').addClass('ace').wrap('<label />').after('<span class="lbl align-top" />');
             $('.ui-jqgrid-labels th[id*="_cb"]').find('input.cbox[type=checkbox]').addClass('ace').wrap('<label />').after('<span class="lbl align-top" />');
        },
        //unlike navButtons icons, action icons in rows seem to be hard-coded
        //you can change them like this in here if you want
        updateActionIcons:function(table) {
            // var replacement = {
            //     'ui-ace-icon fa fa-pencil' : 'ace-icon fa fa-pencil blue',
            //     'ui-ace-icon fa fa-trash-o' : 'ace-icon fa fa-trash-o red',
            //     'ui-icon-disk' : 'ace-icon fa fa-check green',
            //     'ui-icon-cancel' : 'ace-icon fa fa-times red'
            // };
            // $(table).find('.ui-pg-div span.ui-icon').each(function(){
            //     var icon = $(this);
            //     var $class = $.trim(icon.attr('class').replace('ui-icon', ''));
            //     if($class in replacement) icon.attr('class', 'ui-icon '+replacement[$class]);
            // });
        },
        //replace icons with FontAwesome icons like above
        updatePagerIcons:function(table) {
            var replacement = {
                'ui-icon-seek-first' : 'ace-icon fa fa-angle-double-left bigger-140',
                'ui-icon-seek-prev' : 'ace-icon fa fa-angle-left bigger-140',
                'ui-icon-seek-next' : 'ace-icon fa fa-angle-right bigger-140',
                'ui-icon-seek-end' : 'ace-icon fa fa-angle-double-right bigger-140'
            };
            $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function(){
                var icon = $(this);
                var $class = $.trim(icon.attr('class').replace('ui-icon', ''));
                if($class in replacement) icon.attr('class', 'ui-icon '+replacement[$class]);
            });
        },
        enableTooltips:function(table) {
            $('.navtable .ui-pg-button').tooltip({container:'body'});
            $(table).find('.ui-pg-div').tooltip({container:'body'});
        }
    };
})(jQuery);

(function($){
	if(!Array.prototype.map)
		Array.prototype.map = function(fn,scope) {
		var result = [],ri = 0;
		for (var i = 0,n = this.length; i < n; i++){
		  if(i in this){
		    result[ri++]  = fn.call(scope ,this[i],i,this);
		  }
		}
		return result;
	};
	$.getWindowSize = function(){
		return ["Height","Width"].map(function(name){
		  return window["inner"+name] ||
			document.compatMode === "CSS1Compat" && document.documentElement[ "client" + name ] || document.body[ "client" + name ];
		});
	};
	
})(jQuery);

/*******************************************************************************
 * 文件名称：printReport.js
 * 文件说明：报表打印插件
 * 创建者：maliang
 * 创建时间：2015-11-18
 ******************************************************************************/
(function ($) {
    $.printReport = {
        Init: function (options) {
            var t = this;
            t.options = $.extend({}, $.printReport.defaults, options);
            var url = t.options.url;
            if (!url) {
                return false;
            };
            var config = t.options.data;
            var servletURL = url.split("?")[0];
            var sessionID = t.__getSessionID__(url, config);
            window.open(servletURL + "?op=fr_pdfprint&cmd=native&sessionID=" + sessionID, "_blank");
        },
        __getSessionID__:function(url, config){
            var sessionID = null;
            var udata = null;
            udata = $.extend({op: "getSessionID"}, config);
            $.ajax({
                url: url,
                type: "POST",
                data: udata,
                async: false,
                complete: function(res, status) {
                    if (status == "success") {
                        sessionID = res.responseText;
                    }
                }
            });
            return sessionID;
        }
    };
    $.printReport.defaults = {
        'url': '',
        'data':{}
    };
})(jQuery);

Array.prototype.indexOf = function(val) {
	for (var i = 0; i < this.length; i++) {
		if (this[i] == val) return i;
	}
	return -1;
};
	
Array.prototype.remove = function(val) {
	var index = this.indexOf(val);
	if (index > -1) {
		this.splice(index, 1);
	}
};

/*******************************************************************************
 * 文件名称：chosenSuper.js
 * 文件说明：chosen-select增强版
 * 创建者：maliang
 * 创建时间：2016-06-23
 ******************************************************************************/
(function($){
    $.fn.chosenSuper = function(options){
        var self = this;
        if(!ace.vars['touch']) {
            self.chosen(options);
            //resize the chosen on window resize
            $(window).off('resize.chosen').on('resize.chosen', function() {
                self.each(function() {
                    var $this = $(this);
                    $this.next().css({'width': $this.parent().width()});
                });
            }).trigger('resize.chosen');
            //resize chosen on sidebar collapse/expand
            $(document).on('settings.ace.chosen', function(e, event_name, event_val) {
                if(event_name != 'sidebar_collapsed') return;
                self.each(function() {
                    var $this = $(this);
                    $this.next().css({'width': $this.parent().width()});
                });
            });
        }
    };
})(jQuery);

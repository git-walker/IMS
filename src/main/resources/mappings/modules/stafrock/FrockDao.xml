<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.rootyu.rad.modules.stafrock.dao.FrockDao">
	<sql id="llmFrockColumns">
		a.id AS "id",
		a.frock_num AS "frockNum",
		a.belong_area AS "belongArea",
		a.cur_task AS "curTask",
		a.cur_pos AS "curPos",
		a.wait_time AS "waitTime",
		a.repair_status AS "repairStatus",
		a.repair_uid AS "repairUid",
		a.next_repair AS "nextRepair",
		a.use_rec AS "useRec",
		a.create_by AS "createBy.id",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS "updateDate",
		a.remarks AS "remarks",
		a.del_flag AS "delFlag",
		a.vehicle_model AS "vehicleModel",
		a.status AS "status",
		a.standard AS "standard",
		a.frock_custom AS "frockCustom",
		a.use_num AS "useNum",
		o.id AS "storeroom.id",
		o.name AS "storeroom.name"
	</sql>
	
	<sql id="llmFrockJoins">
		LEFT JOIN sys_office o ON o.id=a.belong_area
	</sql>
    
	<select id="get" resultType="Frock">
		SELECT 
			<include refid="llmFrockColumns"/>
		FROM llm_frock a
		<include refid="llmFrockJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findPage" resultType="Frock">
		SELECT 
			<include refid="llmFrockColumns"/>
		FROM llm_frock a
		<include refid="llmFrockJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="Frock">
		SELECT 
			<include refid="llmFrockColumns"/>
		FROM llm_frock a
		<include refid="llmFrockJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>
		<if test="frockNum != null and frockNum != ''">
			AND frock_num LIKE 
					<if test="dbName == 'oracle'">'%'||#{frockNum}||'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{frockNum}, '%')</if>
		</if>
		<if test="vehicleModel != null and vehicleModel != ''">
			AND vehicle_model = #{vehicleModel}
		</if>
		<if test="frockCustom != null and frockCustom != ''">
			AND frock_custom = #{frockCustom}
		</if>
		<if test="status != null and status != ''">
			AND status = #{status}
		</if>
		<if test="belongArea != null and belongArea != ''">
			AND belong_area = #{belongArea}
		</if>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				
			</otherwise>
		</choose>
	</select>
	<select id="checkValues" resultType="Frock" parameterType="String">
		SELECT 
			<include refid="llmFrockColumns"/>
		FROM llm_frock a
		<include refid="llmFrockJoins"/>
		WHERE a.id = #{id}
	</select>
	<insert id="insert">
		INSERT INTO llm_frock(
			id,
			frock_num,
			belong_area,
			cur_task,
			cur_pos,
			wait_time,
			repair_status,
			repair_uid,
			next_repair,
			use_rec,
			create_by,
			create_date,
			update_by,
			update_date,
			remarks,
			del_flag,
			vehicle_model,
			status,
			standard,
			frock_custom,
			use_num
		) VALUES (
			#{id},
			#{frockNum},
			#{belongArea},
			#{curTask},
			#{curPos},
			#{waitTime},
			#{repairStatus},
			#{repairUid},
			#{nextRepair},
			#{useRec},
			#{createBy.id},
			#{createDate},
			#{updateBy.id},
			#{updateDate},
			#{remarks},
			#{delFlag},
			#{vehicleModel},
			#{status},
			#{standard},
			#{frockCustom},
			#{useNum}
		)
	</insert>
	
	<update id="update">
		UPDATE llm_frock SET 	
			frock_num = #{frockNum},
			belong_area = #{belongArea},
			update_by = #{updateBy.id},
			update_date = #{updateDate},
			remarks = #{remarks},
			vehicle_model = #{vehicleModel},
			standard = #{standard},
			frock_custom = #{frockCustom}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		UPDATE llm_frock SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
	
	<select id="findStordocList" resultType="Stordoc">
        SELECT distinct
		    a.storname AS "storname",         
			a.id AS "id",
			a.storcode AS "storcode"				
		FROM llm_stordoc a
		where pk_corp=#{ERP_CORP_ID} and del_flag != #{DEL_FLAG_DELETE}
		ORDER BY a.storcode ASC

	</select>
	<select id="findOfficeList" resultType="Office" >
		SELECT
		   a.id AS "id" ,
		   a.name AS  "name"  
		FROM sys_office a
		where a.parent_id='e78d9277e1bd48eea3c28a1da7d190c4' and company_id = #{ERP_CORP_ID} and del_flag != #{DEL_FLAG_DELETE}
		ORDER BY a.code ASC
	</select>		
</mapper>
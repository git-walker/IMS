<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.rootyu.ims.tools.dao.SelectPageDao">

    <select id="findUserPage" resultType="cn.rootyu.ims.tools.entity.SelectPage">
        SELECT
        u.ID AS "id",
        u.NAME||'('||u.login_name||')' AS "text"
        FROM SYS_USER u
        WHERE u.DEL_FLAG = '0'
        <if test="seachMessage!=null and seachMessage!=''">
            AND u.NAME||'('||u.login_name||')' LIKE '%'||#{seachMessage}||'%'
        </if>
    </select>
    <select id="findCompanyLeaderUserPage" resultType="cn.rootyu.ims.tools.entity.SelectPage">
        SELECT
        u.ID AS "id",
        u.NAME||'('||u.login_name||')' AS "text"
        FROM SYS_USER u
        INNER JOIN SYS_USER_ROLE B ON u.ID=B.USER_ID
        INNER JOIN SYS_ROLE C ON B.ROLE_ID=C.ID
        WHERE u.DEL_FLAG = '0' and C.NAME='公司领导'
        <if test="seachMessage!=null and seachMessage!=''">
            AND u.NAME||'('||u.login_name||')' LIKE '%'||#{seachMessage}||'%'
        </if>
    </select>

    <select id="findOfficeUserPage" resultType="cn.rootyu.ims.tools.entity.SelectPage">
        SELECT
        u.ID AS "id",
        u.NAME||'('||u.login_name||')' AS "text"
        FROM SYS_USER u where u.office_id=#{param}
        <if test="seachMessage!=null and seachMessage!=''">
            AND u.NAME||'('||u.login_name||')' LIKE '%'||#{seachMessage}||'%'
        </if>
    </select>
    <select id="findOfficePage" resultType="cn.rootyu.ims.tools.entity.SelectPage">
        SELECT
        o.ID AS "id",
        o.NAME AS "text"
        FROM SYS_OFFICE o
        WHERE o.DEL_FLAG = '0'
        <if test="seachMessage!=null and seachMessage!=''">
            AND o.NAME LIKE '%'||#{seachMessage}||'%'
        </if>
    </select>
    <select id="findResponUnitPage" resultType="cn.rootyu.ims.tools.entity.SelectPage">

        <choose>
            <when test="param=='10'.toString()">
                SELECT t.ID AS "id",
                t.NAME AS "text"
                FROM SYS_OFFICE t
                WHERE t.DEL_FLAG = '0'
                <if test="seachMessage!=null and seachMessage!=''">
                    AND t.NAME LIKE '%'||#{seachMessage}||'%'
                </if>
            </when>
            <when test="param=='20'.toString()">
                SELECT t.ID AS "id",
                t.SPL_NAME AS "text"
                FROM QMIS_BAS_SUPPLIER_INFO t
                WHERE t.DEL_FLAG='0'
                <if test="seachMessage!=null and seachMessage!=''">
                    AND t.SPL_NAME LIKE '%'||#{seachMessage}||'%'
                </if>
            </when>
            <otherwise>
                SELECT '请选择正确的单位分类！' AS "text" FROM DUAL
            </otherwise>
        </choose>

    </select>
    <select id="findAttendResponUnitPage" resultType="cn.rootyu.ims.tools.entity.SelectPage">

        <choose>
            <when test="param=='10'.toString()">
                SELECT a.ATTEND_UNIT_ID AS "id",
                o.NAME AS "text"
                FROM QMIS_MEETING_ATTENDUNIT a
                INNER JOIN SYS_OFFICE o ON a.ATTEND_UNIT_ID = o.ID
                WHERE o.DEL_FLAG = '0'
                <if test="seachMessage!=null and seachMessage!=''">
                    AND o.NAME LIKE '%'||#{seachMessage}||'%'
                </if>
                AND a.MEETING_ID = #{id}
            </when>
            <when test="param=='20'.toString()">
                SELECT a.ATTEND_UNIT_ID AS "id",
                        i.SPL_NAME AS "text"
                FROM QMIS_MEETING_ATTENDUNIT a
                INNER JOIN QMIS_BAS_SUPPLIER_INFO i ON a.ATTEND_UNIT_ID = i.ID
                WHERE i.DEL_FLAG='0'
                <if test="seachMessage!=null and seachMessage!=''">
                    AND i.SPL_NAME LIKE '%'||#{seachMessage}||'%'
                </if>
                AND a.MEETING_ID = #{id}
            </when>
            <otherwise>
                SELECT '请选择正确的单位分类！' AS "text" FROM DUAL
            </otherwise>
        </choose>

    </select>


</mapper>